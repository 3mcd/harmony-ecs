<!DOCTYPE html><html class="default no-js"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>harmony-ecs</title><meta name="description" content="Documentation for harmony-ecs"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">harmony-ecs</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>harmony-ecs</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#harmony-ecs" id="harmony-ecs" style="color: inherit; text-decoration: none;">
  <h1>harmony-ecs</h1>
</a>
<p>An Entity-Component-System (ECS) focused on compatibility and performance. Harmony has a small footprint, making it a good set of building blocks to create a full ECS with.</p>

<a href="#features" id="features" style="color: inherit; text-decoration: none;">
  <h2>Features</h2>
</a>
<ul>
<li>Hybrid struct-of-array <code>{x: [0]}</code> and array-of-struct <code>[{x: 0}]</code> storage</li>
<li>Scalar and complex components e.g., <code>1.23</code> and <code>{position: {x: 1.23}}</code></li>
<li>Fast iteration and mutation (<a href="https://github.com/3mcd/ecs-benchmark/tree/harmony-ecs">benchmarks</a>)</li>
<li>Fast insert/relocate and auto-updating queries thanks to a <a href="./graph.png">connected archetype graph</a></li>
<li>Compatible with third-party libraries like Three.js, Cannon, etc.</li>
</ul>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h2>Installation</h2>
</a>
<pre><code class="language-sh"><span class="hl-0">npm install harmony-ecs</span>
</code></pre>

<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
  <h2>Documentation</h2>
</a>
<ul>
<li><a href="https://github.com/3mcd/harmony-ecs/wiki">Wiki</a></li>
<li><a href="https://3mcd.github.io/harmony-ecs">API docs</a></li>
</ul>

<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
  <h2>Examples</h2>
</a>
<p>This repo contains examples in the <a href="./examples"><code>examples</code></a> directory. You can run each project using <code>npm run example:*</code>, where <code>*</code> is the name of an example subdirectory.</p>
<p>Below is a sample of Harmony&#39;s API, where a TypedArray <code>Velocity</code> component is used to update an object <code>Position</code> component:</p>
<pre><code class="language-ts"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">World</span><span class="hl-0">, </span><span class="hl-2">Schema</span><span class="hl-0">, </span><span class="hl-2">Entity</span><span class="hl-0">, </span><span class="hl-2">Query</span><span class="hl-0">, </span><span class="hl-2">Format</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&quot;harmony-ecs&quot;</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">Vector2</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-2">x:</span><span class="hl-0"> </span><span class="hl-2">Format</span><span class="hl-0">.</span><span class="hl-2">float64</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-2">y:</span><span class="hl-0"> </span><span class="hl-2">Format</span><span class="hl-0">.</span><span class="hl-2">float64</span><span class="hl-0">,</span><br/><span class="hl-0">}</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">world</span><span class="hl-0"> = </span><span class="hl-2">World</span><span class="hl-0">.</span><span class="hl-6">make</span><span class="hl-0">(</span><span class="hl-7">1_000_000</span><span class="hl-0">)</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">Position</span><span class="hl-0"> = </span><span class="hl-2">Schema</span><span class="hl-0">.</span><span class="hl-6">make</span><span class="hl-0">(</span><span class="hl-2">world</span><span class="hl-0">, </span><span class="hl-2">Vector2</span><span class="hl-0">)</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">Velocity</span><span class="hl-0"> = </span><span class="hl-2">Schema</span><span class="hl-0">.</span><span class="hl-6">makeBinary</span><span class="hl-0">(</span><span class="hl-2">world</span><span class="hl-0">, </span><span class="hl-2">Vector2</span><span class="hl-0">)</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">Kinetic</span><span class="hl-0"> = [</span><span class="hl-2">Position</span><span class="hl-0">, </span><span class="hl-2">Velocity</span><span class="hl-0">] </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">const</span><br/><br/><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-2">i</span><span class="hl-0"> = </span><span class="hl-7">0</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0"> &lt; </span><span class="hl-7">1_000_000</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0">++) {</span><br/><span class="hl-0">  </span><span class="hl-2">Entity</span><span class="hl-0">.</span><span class="hl-6">make</span><span class="hl-0">(</span><span class="hl-2">world</span><span class="hl-0">, </span><span class="hl-2">Kinetic</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">kinetics</span><span class="hl-0"> = </span><span class="hl-2">Query</span><span class="hl-0">.</span><span class="hl-6">make</span><span class="hl-0">(</span><span class="hl-2">world</span><span class="hl-0">, </span><span class="hl-2">Kinetic</span><span class="hl-0">)</span><br/><br/><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-4">const</span><span class="hl-0"> [</span><span class="hl-5">entities</span><span class="hl-0">, [</span><span class="hl-5">p</span><span class="hl-0">, </span><span class="hl-5">v</span><span class="hl-0">]] </span><span class="hl-4">of</span><span class="hl-0"> </span><span class="hl-2">kinetics</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-2">i</span><span class="hl-0"> = </span><span class="hl-7">0</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0"> &lt; </span><span class="hl-2">entities</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0">++) {</span><br/><span class="hl-0">    </span><span class="hl-2">p</span><span class="hl-0">[</span><span class="hl-2">i</span><span class="hl-0">].</span><span class="hl-2">x</span><span class="hl-0"> += </span><span class="hl-2">v</span><span class="hl-0">.</span><span class="hl-2">x</span><span class="hl-0">[</span><span class="hl-2">i</span><span class="hl-0">]</span><br/><span class="hl-0">    </span><span class="hl-2">p</span><span class="hl-0">[</span><span class="hl-2">i</span><span class="hl-0">].</span><span class="hl-2">y</span><span class="hl-0"> += </span><span class="hl-2">v</span><span class="hl-0">.</span><span class="hl-2">y</span><span class="hl-0">[</span><span class="hl-2">i</span><span class="hl-0">]</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>Harmony does not modify objects, making it highly compatible with third-party libraries. Take the following example where an entity is composed of a Three.js mesh, Cannon.js rigid body, and some proprietary TypedArray-backed data.</p>
<pre><code class="language-ts"><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">Vector3</span><span class="hl-0"> = { </span><span class="hl-2">x:</span><span class="hl-0"> </span><span class="hl-2">Format</span><span class="hl-0">.</span><span class="hl-2">float64</span><span class="hl-0"> </span><span class="hl-8">/* etc */</span><span class="hl-0"> }</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">Mesh</span><span class="hl-0"> = </span><span class="hl-2">Schema</span><span class="hl-0">.</span><span class="hl-6">make</span><span class="hl-0">(</span><span class="hl-2">world</span><span class="hl-0">, { </span><span class="hl-2">position:</span><span class="hl-0"> </span><span class="hl-2">Vector3</span><span class="hl-0"> })</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">Body</span><span class="hl-0"> = </span><span class="hl-2">Schema</span><span class="hl-0">.</span><span class="hl-6">make</span><span class="hl-0">(</span><span class="hl-2">world</span><span class="hl-0">, { </span><span class="hl-2">position:</span><span class="hl-0"> </span><span class="hl-2">Vector3</span><span class="hl-0"> })</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">PlayerInfo</span><span class="hl-0"> = </span><span class="hl-2">Schema</span><span class="hl-0">.</span><span class="hl-6">makeBinary</span><span class="hl-0">(</span><span class="hl-2">world</span><span class="hl-0">, { </span><span class="hl-2">id:</span><span class="hl-0"> </span><span class="hl-2">Format</span><span class="hl-0">.</span><span class="hl-2">uint32</span><span class="hl-0"> })</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">Player</span><span class="hl-0"> = [</span><span class="hl-2">Mesh</span><span class="hl-0">, </span><span class="hl-2">Body</span><span class="hl-0">, </span><span class="hl-2">PlayerInfo</span><span class="hl-0">] </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">const</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">mesh</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Three</span><span class="hl-0">.</span><span class="hl-6">Mesh</span><span class="hl-0">(</span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Three</span><span class="hl-0">.</span><span class="hl-6">SphereGeometry</span><span class="hl-0">(), </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Three</span><span class="hl-0">.</span><span class="hl-6">MeshBasicMaterial</span><span class="hl-0">())</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">body</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Cannon</span><span class="hl-0">.</span><span class="hl-6">Body</span><span class="hl-0">({ </span><span class="hl-2">mass:</span><span class="hl-0"> </span><span class="hl-7">1</span><span class="hl-0">, </span><span class="hl-2">shape:</span><span class="hl-0"> </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-2">Cannon</span><span class="hl-0">.</span><span class="hl-6">Sphere</span><span class="hl-0">(</span><span class="hl-7">1</span><span class="hl-0">) })</span><br/><br/><span class="hl-2">Entity</span><span class="hl-0">.</span><span class="hl-6">make</span><span class="hl-0">(</span><span class="hl-2">world</span><span class="hl-0">, </span><span class="hl-2">Player</span><span class="hl-0">, [</span><span class="hl-2">mesh</span><span class="hl-0">, </span><span class="hl-2">body</span><span class="hl-0">, { </span><span class="hl-2">id:</span><span class="hl-0"> </span><span class="hl-7">123</span><span class="hl-0"> }])</span>
</code></pre>
<p>Note that we still need to define the shape of third party objects, as seen in the <code>Mesh</code> and <code>Body</code> variables. This supplies Harmony with static type information for queries and provides the ECS with important runtime information for serialization, etc.</p>

<a href="#performance-tests" id="performance-tests" style="color: inherit; text-decoration: none;">
  <h2>Performance Tests</h2>
</a>
<p>Run the performance test suite using <code>npm run perf:node</code> or <code>npm perf:browser</code>. Example output:</p>
<pre><code><span class="hl-2">iterBinary</span><br/><span class="hl-0">----------</span><br/><span class="hl-2">iter</span><br/><span class="hl-2">iterations</span><span class="hl-0"> </span><span class="hl-7">100</span><br/><span class="hl-0">┌─────────┬────────────┐</span><br/><span class="hl-0">│ (</span><span class="hl-2">index</span><span class="hl-0">) │   </span><span class="hl-2">Values</span><span class="hl-0">   │</span><br/><span class="hl-0">├─────────┼────────────┤</span><br/><span class="hl-0">│ </span><span class="hl-2">average</span><span class="hl-0"> │ </span><span class="hl-3">&#39;12.46 ms&#39;</span><span class="hl-0"> │</span><br/><span class="hl-0">│ </span><span class="hl-2">median</span><span class="hl-0">  │ </span><span class="hl-3">&#39;12.03 ms&#39;</span><span class="hl-0"> │</span><br/><span class="hl-0">│   </span><span class="hl-2">min</span><span class="hl-0">   │ </span><span class="hl-3">&#39;11.71 ms&#39;</span><span class="hl-0"> │</span><br/><span class="hl-0">│   </span><span class="hl-2">max</span><span class="hl-0">   │ </span><span class="hl-3">&#39;18.76 ms&#39;</span><span class="hl-0"> │</span><br/><span class="hl-0">└─────────┴────────────┘</span>
</code></pre>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class=" tsd-kind-namespace"><a href="modules/Cache.html">Cache</a></li><li class=" tsd-kind-namespace"><a href="modules/Entity.html">Entity</a></li><li class=" tsd-kind-namespace"><a href="modules/Format.html">Format</a></li><li class=" tsd-kind-namespace"><a href="modules/Schema.html">Schema</a></li><li class=" tsd-kind-namespace"><a href="modules/Query.html">Query</a></li><li class=" tsd-kind-namespace"><a href="modules/Signal.html">Signal</a></li><li class=" tsd-kind-namespace"><a href="modules/SparseMap.html">Sparse<wbr/>Map</a></li><li class=" tsd-kind-namespace"><a href="modules/Type.html">Type</a></li><li class=" tsd-kind-namespace"><a href="modules/Types.html">Types</a></li><li class=" tsd-kind-namespace"><a href="modules/World.html">World</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#Data" class="tsd-kind-icon">Data</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>